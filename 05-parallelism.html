<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>Parallelism</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Mount-lite</span> <span class="project-version">0.9.8</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="01-basics.html"><div class="inner"><span>The basics</span></div></a></li><li class="depth-1 "><a href="02-substitutions.html"><div class="inner"><span>Substitutions</span></div></a></li><li class="depth-1 "><a href="03-start-stop-options.html"><div class="inner"><span>Start/stop options</span></div></a></li><li class="depth-1 "><a href="04-reloading.html"><div class="inner"><span>Reloading defstates</span></div></a></li><li class="depth-1  current"><a href="05-parallelism.html"><div class="inner"><span>Parallelism</span></div></a></li><li class="depth-1 "><a href="06-bindings.html"><div class="inner"><span>Bindings</span></div></a></li><li class="depth-1 "><a href="07-troubleshooting.html"><div class="inner"><span>Troubleshooting</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mount</span></div></div></li><li class="depth-2"><a href="mount.lite.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lite</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#parallelism" name="parallelism"></a>Parallelism</h1>
<p>A unique feature of mount-lite is being able to start and stop the defstates in parallel to each other, wherever applicable. It does this by calculating a dependency graph of all the states (just like it does with the <code>:up-to</code> option described in the section about start/stop options). The defstates are started (or stopped) as eagerly as possible using a - user specified - number of threads.</p>
<blockquote>
  <p>NOTE: To visualize the dependency graph of all the states, one can use the <code>dot</code> function.</p>
</blockquote>
<p>Defstates by default depend on the other defstates in the same namespace defined above them, and on the defstates in the referenced namespaces (transitively). So, the parallelism is normally to be gained on a namespace level.</p>
<h2><a href="#an-example" name="an-example"></a>An example</h2>
<p>The following example shows how parallelism works:</p>
<pre><code class="clj">;; Make following defstate graph
;;
;;  core ----&gt; mid1 -.
;;                    }-&gt; end
;;             mid2 -&#39;
;;
;; Note that the :dependencies metadata is normally an
;; optional and advanced option.

(defstate end
  :start (do (println &quot;Starting &#39;end&#39;  at 0&quot;)
             (let [start (System/currentTimeMillis)]
               (Thread/sleep 500)
               start)))

(defstate mid1
  {:dependencies #{#&#39;end}}
  :start (do (println &quot;Starting &#39;mid1&#39; at&quot;
                      (- (System/currentTimeMillis) end))
             (Thread/sleep 500)))

(defstate mid2
  {:dependencies #{#&#39;end}}
  :start (do (println &quot;Starting &#39;mid2&#39; at&quot;
                      (- (System/currentTimeMillis) end))
             (Thread/sleep 500)))

(defstate core
  {:dependencies #{#&#39;mid1}}
  :start (do (println &quot;Starting &#39;core&#39; at&quot;
                      (- (System/currentTimeMillis) end))
             (Thread/sleep 500)))

;; Test the parallelism:

(time (mount.lite/start (mount.lite/parallel 2)))
;&gt;&gt; Starting &#39;end&#39;  at 0 ...
;&gt;&gt; Starting &#39;mid1&#39; at 500 ...
;&gt;&gt; Starting &#39;mid2&#39; at 501 ...
;&gt;&gt; Starting &#39;core&#39; at 1006 ...
;&gt;&gt; &quot;Elapsed time: 1791.079279 msecs&quot;
;=&gt; (#&#39;end/end #&#39;mid1/mid2 #&#39;mid2/mid1 #&#39;core/core)
</code></pre>
<p>In above example one can see that states <code>mid1</code> and <code>mid2</code> are started almost simultaneously. Note that when one would stop above example in parallel, the states <code>core</code> and <code>mid2</code> will be stopped simultaneously.</p>
<h2><a href="#the-dependencies-metadata" name="the-dependencies-metadata"></a>The :dependencies metadata</h2>
<p>If you really want to get the most out of parallelism, you can declare the dependencies on a state by putting <code>:dependencies</code> in its metadata. This way states don&rsquo;t necessarily depend on other states in the same namespace or referenced namespaces.</p></div></div></div></body></html>