<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>The basics</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Mount-lite</span> <span class="project-version">2.0.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="01-basics.html"><div class="inner"><span>The basics</span></div></a></li><li class="depth-1 "><a href="02-substitutions.html"><div class="inner"><span>Substitutions</span></div></a></li><li class="depth-1 "><a href="03-start-stop-options.html"><div class="inner"><span>Start up to / stop down to</span></div></a></li><li class="depth-1 "><a href="04-systems-of-states.html"><div class="inner"><span>Multiple systems of states</span></div></a></li><li class="depth-1 "><a href="05-extension-point.html"><div class="inner"><span>Extension point</span></div></a></li><li class="depth-1 "><a href="06-migrating-to-2.html"><div class="inner"><span>Migrating to 2.x</span></div></a></li><li class="depth-1 "><a href="07-troubleshooting.html"><div class="inner"><span>Troubleshooting</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mount</span></div></div></li><li class="depth-2"><a href="mount.lite.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lite</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#the-basics" name="the-basics"></a>The basics</h1>
<h2><a href="#what-is-mount-lite-for-" name="what-is-mount-lite-for-"></a>What is mount-lite for?</h2>
<p>The mount-lite library was inspired by <a href="https://github.com/tolitius/mount">mount</a>. If you know that library, you already know what you can do with it, as mount-lite is based on the same premise.</p>
<p>This premise is to have a basic lifecycle around the stateful parts of your application. Using this lifecycle, you can quickly bring up the application state, and bring it down again, before or after reloading (parts of) your application. The mount and mount-lite libraries give you an easy and non-intrusive way of adding such lifecycles to the stateful parts of your application.</p>
<p>The mount-lite library has some unique features and approach with respect to mount. For more info on why mount-lite was created, see <a href="http://www.functionalbytes.nl/clojure/mount/mount-lite/2016/02/11/mount-lite.html">this blog post</a>.</p>
<p>That blog post covers the 0.9.x version, and quite some things have changed with version 2.0. In short, the API has been simplified and the feature to have multiple systems of states simultaneously has been added. See <a href="http://www.functionalbytes.nl/clojure/mount/mount-lite/2016/12/09/mount-lite-2.html">this blog post</a> for more info on what has changed, and why.</p>
<p>This documentation covers the functionality of version 2.x. Version 0.9.x is still supported though, and its documentation can be found in the source repository.</p>
<h2><a href="#defining-states" name="defining-states"></a>Defining states</h2>
<p>First, require the <code>mount.lite</code> namespace. Also require the namespaces which hold the states that the states in the current namespace depend upon.</p>
<pre><code class="clj">(ns your.app
  (:require [mount.lite :refer (defstate) :as mount]
            [your.app.config :as config] ;; &lt;-- Also has a defstate defined.
            [some.db.lib :as db]))
</code></pre>
<p>Defining a state is done with the <code>defstate</code> macro. The simplest of such a global state definition, is one with a name and a <code>:start</code> expression. In this example we also supply a <code>:stop</code> expression.</p>
<pre><code class="clj">(defstate db
  :start (db/start (get-in @config/config [:db :url]))
  :stop (db/stop @db))
;=&gt; #&#39;your.app/db
</code></pre>
<p>As you can see, the var <code>#&#39;your.app/db</code> has been defined. It currently is in the <code>:stopped</code> status.</p>
<p>The <code>:start</code> expression above uses another global state - <code>config/config</code> - which it dereferences to get its value. The <code>:stop</code> expression uses its own value in the same way.</p>
<h2><a href="#starting-and-stopping-the-states" name="starting-and-stopping-the-states"></a>Starting and stopping the states</h2>
<p>To start all the global states, just call <code>(mount/start)</code>. A sequence of started global state vars is returned. The order in which the states are started is determined by their load order by the Clojure compiler. Using <code>(mount/stop)</code> stops all the started defstates in reverse order.</p>
<pre><code class="clj">@db
;=&gt; ExceptionInfo: state is not started

(mount/start)
;=&gt; (#&#39;your.app.config/config #&#39;your.app/db)

@db
;=&gt; object[some.db.Object 0x12345678]

(mount/stop)
;=&gt; (#&#39;your.app/db #&#39;your.app.config/config)
</code></pre>
<blockquote>
  <p>NOTE: To get an overview of the status of the defstates, you can use the <code>status</code> function.</p>
</blockquote>
<p><em>Now you know the basics. Go on, try it! I will see you in 10 minutes.</em></p>
<h2><a href="#meta-data-on-defstate" name="meta-data-on-defstate"></a>Meta data on defstate</h2>
<p>The <code>defstate</code> macro supports docstrings and attribute maps, as well as meta data on the name of the <code>defstate</code>, just like <code>defn</code>. So, a full <code>defstate</code> might look something like this:</p>
<pre><code class="clj">(defstate ^:private db
  &quot;My database state&quot;
  {:attribute &#39;map}
  :start ...
  :stop ...)
</code></pre>
<h2><a href="#design-considerations" name="design-considerations"></a>Design considerations</h2>
<p>Consider the following in your design when using mount-lite (or mount for that matter):</p>
<ul>
  <li>
  <p>Only use <code>defstate</code> in your application namespaces, not in library namespaces, and preferable in the outskirts of your application.  Having a global state does not mean you should forego on the good practice of passing state along as arguments to functions.</p></li>
  <li>
  <p>Only use <code>defstate</code> when either the stateful object needs some stop logic before the application can be reloaded/restarted, or whenever the state depends on another <code>defstate</code>.  In other cases, just use a def.</p></li>
</ul>
<h2><a href="#further-reading" name="further-reading"></a>Further reading</h2>
<p>Now that you know the basics, it is advised to learn about at least one other feature of mount-lite: <a href="02-substitutions.html">substituting</a>. You could also read on how to <a href="03-start-stop-options.html">start up to or stop down</a> to a certain state, or how to start <a href="04-systems-of-states.html">multiple systems of states</a> simultaneously.</p></div></div></div></body></html>